<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Summer 2024 progress report | Miralis</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://miralis-firmware.github.io/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://miralis-firmware.github.io/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://miralis-firmware.github.io/blog/summer-2024-progress-report"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Summer 2024 progress report | Miralis"><meta data-rh="true" name="description" content="Three months and 110 commits after the open-sourcing of Miralis we have come a long way, and now sounds like a good time for our first ever progress report."><meta data-rh="true" property="og:description" content="Three months and 110 commits after the open-sourcing of Miralis we have come a long way, and now sounds like a good time for our first ever progress report."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-09-29T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="News"><link data-rh="true" rel="icon" href="/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://miralis-firmware.github.io/blog/summer-2024-progress-report"><link data-rh="true" rel="alternate" href="https://miralis-firmware.github.io/blog/summer-2024-progress-report" hreflang="en"><link data-rh="true" rel="alternate" href="https://miralis-firmware.github.io/blog/summer-2024-progress-report" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://miralis-firmware.github.io/blog/summer-2024-progress-report","mainEntityOfPage":"https://miralis-firmware.github.io/blog/summer-2024-progress-report","url":"https://miralis-firmware.github.io/blog/summer-2024-progress-report","headline":"Summer 2024 progress report","name":"Summer 2024 progress report","description":"Three months and 110 commits after the open-sourcing of Miralis we have come a long way, and now sounds like a good time for our first ever progress report.","datePublished":"2024-09-29T00:00:00.000Z","dateModified":"2024-09-29T17:20:22.000Z","author":{"@type":"Person","name":"Charly Castes","image":"https://github.com/charlycst.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://miralis-firmware.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Miralis RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Miralis Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Miralis JSON Feed"><link rel="stylesheet" href="/assets/css/styles.1390f8cc.css">
<script src="/assets/js/runtime~main.a5456e2d.js" defer="defer"></script>
<script src="/assets/js/main.23297be6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/miralis_icon.svg" alt="Miralis logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/miralis_icon.svg" alt="Miralis logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Miralis</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/dashboard">Dashboard</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/charlycst/miralis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/end-2024-progress-report">Fall 2024 progress report</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/summer-2024-progress-report">Summer 2024 progress report</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hello-world">Hello, world!</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Summer 2024 progress report</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-09-29T00:00:00.000Z">September 29, 2024</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/charlycst"><img class="avatar__photo authorImage_XqGP" src="https://github.com/charlycst.png" alt="Charly Castes"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/charlycst"><span class="authorName_yefp">Charly Castes</span></a></div><div class="authorSocials_rSDt"><a href="https://x.com/CharlyCastes" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" class="authorSocialLink_owbf xSvg_y3PF" style="--dark:#000;--light:#fff"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/CharlyCst" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg viewBox="0 0 256 250" width="1em" height="1em" class="authorSocialLink_owbf githubSvg_Uu4N" xmlns="http://www.w3.org/2000/svg" style="--dark:#000;--light:#fff" preserveAspectRatio="xMidYMid"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://charlycst.github.io" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="website"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="authorSocialLink_owbf"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path><path d="M3.6 9h16.8"></path><path d="M3.6 15h16.8"></path><path d="M11.5 3a17 17 0 0 0 0 18"></path><path d="M12.5 3a17 17 0 0 1 0 18"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Three months and 110 commits after the <a href="https://github.com/CharlyCst/miralis" target="_blank" rel="noopener noreferrer">open-sourcing of Miralis</a> we have come a long way, and now sounds like a good time for our first ever progress report.
This summer we had the chance to host Sofia and NoÃ© at the lab, they both have been doing stellar work and Miralis would be nowhere close to where it is today without them, so kudos to both of them, it has really been a pleasure to work together!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="miralis-in-a-nutshell">Miralis in a nutshell<a href="#miralis-in-a-nutshell" class="hash-link" aria-label="Direct link to Miralis in a nutshell" title="Direct link to Miralis in a nutshell">â€‹</a></h2>
<p>Miralis is the first implementation of what we call a <strong>virtual firmware monitor</strong>, or VFM for short.
A VFM is a system that virtualizes the firmware privilege mode, similar to how software-based hypervisors can virtualize the kernel mode.
Miralis is written in Rust and targets RISC-V platforms, it can run unmodified de-privileged firmware in U-mode, which we call virtual M-mode or vM-mode for short.
The purpose of Miralis is to protect sensitive workloads from potentially untrusted firmware, a thorny problem especially in the era of confidential computing and trusted execution environments.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summer-2024">Summer 2024<a href="#summer-2024" class="hash-link" aria-label="Direct link to Summer 2024" title="Direct link to Summer 2024">â€‹</a></h2>
<p>Over the summer we focused on two major milestones: <strong>full Linux support</strong> and <strong>porting Miralis to the VisionFive 2 board</strong>.
While we need to polish out a few rough edges, I think we can say that we delivered on both objectives.
As a bonus thanks to the great work of Sofia and NoÃ© we even managed to submit a first paper that got accepted to the <a href="https://kisv-workshop.github.io/" target="_blank" rel="noopener noreferrer">KISV 2024 workshop</a>, the final version will be published soon (Yay! ğŸ¥³).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="full-linux-support">Full Linux support<a href="#full-linux-support" class="hash-link" aria-label="Direct link to Full Linux support" title="Direct link to Full Linux support">â€‹</a></h3>
<p>This summer we achieved full Linux support on QEMU, which means that Linux can run seamlessly with a virtualized OpenSBI.
When running an Operating system along with a virtualized firmware with Miralis the deployment looks like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">U-mode  â”‚             â”‚ â”‚  OpenSBI  â”‚ vM-mode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â”‚    Linux    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”˜</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">S-mode  â”‚             â”‚</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">M-mode  â”‚          Miralis          â”‚</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An important note is that Miralis only virtualizes the firmware, which means that the OS (both the Linux kernel and user-space applications) executes natively at full speed until it traps to the firmware, at which point Miralis triggers a world switch toward the virtualized M-mode.
This is similar to software-based virtual machine monitors that pre-dates hardware virtualization extensions, such as the <a href="https://dl.acm.org/doi/abs/10.1145/2382553.2382554?casa_token=Lm-qUMZ5qmEAAAAA:B_O-hl8qBIMBN2xXD-cnlH3GU0Js8yUAsVfAH-O2zPz1t8VTAM2A-D9qRC7fT8ucoRNyNK_hI2Knr24" target="_blank" rel="noopener noreferrer">original VMWare Workstation</a>.
Those VMMs run user-space applications natively but switch to an efficient virtualized mode for kernel code execution.
Miralis is heavily inspired by those early designs, but virtualizes the firmware rather than the kernel.</p>
<p>The interesting bits here is that neither OpenSBI nor Linux need to be modified to run with Miralis.
This works without re-compilation because both of them are position independent, but even for non-position independent software we would not need to change the source code (beside the base address if hardcoded) because RISC-V has the nice property of being a virtualizable architecture.
This is very important for us, as we want to provide full backward-compatibility with Miralis.</p>
<p>The main challenge in getting Linux to work properly is interrupt virtualization.
While we mostly had to handle M-mode timer interrupts before, Linux virtualization requires proper handling of all kinds of interrupts.
The trickiest one was the supervisor external interrupt (<code>SEI</code>), which has a different semantic than other interrupt bits: there is not one, but two <code>SEI</code> bits, one writable by the hardware, the other by the software, but software can only read the binary <code>OR</code> of those two bits.</p>
<p>We now reached a point where Linux runs smoothly on top of Miralis on the QEMU platform.
We tested with both a small BusyBox-based user-space (which we now run against each pull requests in the CI) and a full ubuntu distribution.
Running Linux on Miralis is now as simple as executing <code>just run linux-shell</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="porting-miralis-to-the-visionfive-2">Porting Miralis to the VisionFive 2<a href="#porting-miralis-to-the-visionfive-2" class="hash-link" aria-label="Direct link to Porting Miralis to the VisionFive 2" title="Direct link to Porting Miralis to the VisionFive 2">â€‹</a></h3>
<p>Our second milestone is porting Miralis to the VisionFive 2 board.
The VisionFive 2 features a JH7110 SoC, with a quad-core SiFive U74 (RV64GC) processor plus one smaller SiFive S7 (RV64IMAC) monitor core.
The feature set of the VisionFive 2 is quite different from what QEMU exposes, which rose quite a few challenges.</p>
<p>The first challenge with the VisionFive 2 was multi-core support.
Not only is the JH7110 a multi-core platform, but it is also heterogeneous.
The smaller SiFive S7 core does not support S-mode, for instance, and has some more restrictions we had to take into account.
We added proper multi-core support to Miralis, which required carefully re-designing the initialization sequence and boot assembly to setup disjoint stacks and initialize global resources such as zeroing-out the <code>.bss</code> section.</p>
<p>Another interesting part is how to insert Miralis in the boot chain.
When the VisionFive 2 boot it starts executing a small read-only bootstrap code, the reset vector, which then jumps to the first writable executable memory.
The vendor-provided software boots like this: reset-vector -&gt; u-boot SPL -&gt; OpenSBI -&gt; u-boot proper -&gt; Linux.
The first run-time resident firmware in the boot chain is OpenSBI, the role of u-boot SPL is mostly to initialize DRAM and transfer control to the next stage but it does not stay active at run time.
We decided to insert Miralis after u-boot SPL, and then transfer control to OpenSBI in the virtual M-mode.
That way Miralis is the only M-mode software present at runtime, as OpenSBI runs deprivileged.</p>
<p>Finally the VisionFive 2 has a more limited set of hardware features compared to QEMU.
One major difference, for instance, is the lack of support for misaligned reads and writes.
On the VisionFive 2 misaligned reads and writes from the kernel are emulated by OpenSBI by changing the memory access privilege (the using the <code>MPRV</code> bit in <code>mstatus</code>).
The <code>MPRV</code> bit allow M-mode software to read and write memory as if it was executing with S or U-mode privilege (but instruction fetches keep using M-mode privileges), which simplifies accessing OS memory by removing the need for software page table walk and permission checks.
However the <code>MPRV</code> bit can&#x27;t be enabled while running virtualized firmware with Miralis as the firmware already executes in U-mode.
We emulated the <code>MPRV</code> bit in Miralis by forcing traps from the firmware to Miralis during reads and writes when the virtual <code>MPRV</code> is set to 1, which enables Miralis to emulate the read or write using S or U-mode privileges using the physical <code>MPRV</code> bit.
There are other differences between QEMU and the VisionFive 2, in particular around devices, but we already managed to close most of the gaps.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-next">What is next<a href="#what-is-next" class="hash-link" aria-label="Direct link to What is next" title="Direct link to What is next">â€‹</a></h2>
<p>With the start of the new academic semester FranÃ§ois and FrÃ©dÃ©ric are joining forces to work on Miralis.
Our objectives for the next few months is to demonstrate how to <strong>enforce security policies with Miralis</strong>.
By default Miralis grants (almost) full access to the machine to the virtualized firmware, therefore it does not provide any security guarantee <em>per se</em>.
There can be many desirable isolation policies, therefore Miralis does not try to provide the &#x27;one true&#x27; security policy, but our goal is rather to enable the implementation of many custom policies.
For instance it might be desirable to isolate confidential VMs or enclaves from the firmware and host OS, or even the whole host OS form the firmware.</p>
<p>Overall I am very enthusiastic about Miralis, the project has already gone a long way and built up a very good momentum.
There is still a lot on our plate to achieve our vision of securing the lowest layer of the software stack, but I am confident we will get there.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="News and updates about Miralis" class="tag_zVej tagRegular_sFm0" href="/blog/tags/news">News</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-09-29T17:20:22.000Z" itemprop="dateModified">Sep 29, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/end-2024-progress-report"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Fall 2024 progress report</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/hello-world"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Hello, world!</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#miralis-in-a-nutshell" class="table-of-contents__link toc-highlight">Miralis in a nutshell</a></li><li><a href="#summer-2024" class="table-of-contents__link toc-highlight">Summer 2024</a><ul><li><a href="#full-linux-support" class="table-of-contents__link toc-highlight">Full Linux support</a></li><li><a href="#porting-miralis-to-the-visionfive-2" class="table-of-contents__link toc-highlight">Porting Miralis to the VisionFive 2</a></li></ul></li><li><a href="#what-is-next" class="table-of-contents__link toc-highlight">What is next</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/dashboard">Dashboard</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li><li class="footer__item"><a href="https://github.com/charlycst/miralis" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>