"use strict";(self.webpackChunkwebsite_miralis=self.webpackChunkwebsite_miralis||[]).push([[8413],{3022:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var t=n(4848),r=n(8453);const o={title:"Project Overview",sidebar_position:3},s=void 0,a={id:"overview",title:"Project Overview",description:"This page gives a high-level overview of the Miralis project and how to work with it.",source:"@site/docs/overview.md",sourceDirName:".",slug:"/overview",permalink:"/docs/overview",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Project Overview",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Quick Start",permalink:"/docs/quick_start"},next:{title:"Configuration",permalink:"/docs/configuration"}},c={},l=[{value:"Project Organization",id:"project-organization",level:2},{value:"Tools",id:"tools",level:2},{value:"Testing and Debugging",id:"testing-and-debugging",level:2},{value:"Build Configuration",id:"build-configuration",level:2},{value:"Test Artifacts",id:"test-artifacts",level:2}];function d(e){const i={a:"a",code:"code",em:"em",h2:"h2",p:"p",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.p,{children:"This page gives a high-level overview of the Miralis project and how to work with it."}),"\n",(0,t.jsx)(i.h2,{id:"project-organization",children:"Project Organization"}),"\n",(0,t.jsxs)(i.p,{children:["The Miralis sources live in ",(0,t.jsx)(i.code,{children:"src"}),", and contains most of the code.\nMiralis does nothing by itself, however, and it needs some ",(0,t.jsx)(i.em,{children:"firmware"})," to virtualize.\nThe ",(0,t.jsx)(i.code,{children:"firmware"})," folder contains simple test firmware, including the ",(0,t.jsx)(i.code,{children:"default"})," firmware selected by ",(0,t.jsx)(i.code,{children:"just run"}),".\nSimilarly, the ",(0,t.jsx)(i.code,{children:"payload"})," folder contains simple test kernels."]}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"runner"})," folder holds the code for the Miralis build tool (the ",(0,t.jsx)(i.code,{children:"runner"}),", see ",(0,t.jsx)(i.a,{href:"#Tools",children:"Tools"}),").\nFor some operations, the runner downloads artifacts, such as test firmware images.\nThose artifacts are stored in the ",(0,t.jsx)(i.code,{children:"artifact"})," folder."]}),"\n",(0,t.jsxs)(i.p,{children:["Another folder of interest is ",(0,t.jsx)(i.code,{children:"config"}),", which stores pre-defined configuration files for testing purposes and for supported hardware platforms."]}),"\n",(0,t.jsxs)(i.p,{children:["Finally, we use formal methods to verify correctness properties of key components of Miralis.\nAll the code related to verification is located under ",(0,t.jsx)(i.code,{children:"model_checking"}),"."]}),"\n",(0,t.jsx)(i.h2,{id:"tools",children:"Tools"}),"\n",(0,t.jsxs)(i.p,{children:["The Miralis project uses ",(0,t.jsx)(i.a,{href:"https://github.com/casey/just",children:(0,t.jsx)(i.code,{children:"just"})})," to easily build, run, and test code.\nThe ",(0,t.jsx)(i.code,{children:"just"})," command can be installed with your favorite package manager or with ",(0,t.jsx)(i.code,{children:"cargo install just"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"justfile"})," holds a collection of useful commands; it is similar to a Makefile without the C build system bits.\n",(0,t.jsx)(i.code,{children:"just"})," is used to provide a stable interface for basic operations, for instance ",(0,t.jsx)(i.code,{children:"just test"})," is guaranteed to work for all commits.\nRunning ",(0,t.jsx)(i.code,{children:"just"})," or ",(0,t.jsx)(i.code,{children:"just help"})," gives the list of available commands."]}),"\n",(0,t.jsxs)(i.p,{children:["Most of the ",(0,t.jsx)(i.code,{children:"justfile"})," commands internally invoke the ",(0,t.jsx)(i.code,{children:"runner"}),".\nThe ",(0,t.jsx)(i.code,{children:"runner"})," is Miralis' build tool; it automates operations such as building Miralis and the test firmware, downloading artifacts such as Linux images, checking the format of configuration files, and orchestrates the integration tests."]}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"runner"})," can be invoked with ",(0,t.jsx)(i.code,{children:"cargo run -- <runner_command>"})," from the root of the repository.\nAlternatively, the recommended option is to install the runner with ",(0,t.jsx)(i.code,{children:"cargo install --path runner"})," and then simply invoke it with ",(0,t.jsx)(i.code,{children:"runner <runner_command>"})," from anywhere in the repository."]}),"\n",(0,t.jsxs)(i.p,{children:["To list all ",(0,t.jsx)(i.code,{children:"runner"})," commands, run ",(0,t.jsx)(i.code,{children:"runner -h"}),", and ",(0,t.jsx)(i.code,{children:"runner <runner_command> -h"})," to list the options for a subcommand."]}),"\n",(0,t.jsx)(i.h2,{id:"testing-and-debugging",children:"Testing and Debugging"}),"\n",(0,t.jsxs)(i.p,{children:["Integration tests can be run with ",(0,t.jsx)(i.code,{children:"just test"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["The firmware can be selected as an additional argument to ",(0,t.jsx)(i.code,{children:"just run"}),".\nValid firmware are either names of firmware under the ",(0,t.jsx)(i.code,{children:"./firmware/"})," directory, some pre-built binaries (such as ",(0,t.jsx)(i.code,{children:"opensbi"}),"), or paths to external firmware images.\nThus, ",(0,t.jsx)(i.code,{children:"just run opensbi"})," will execute OpenSBI on top of Miralis."]}),"\n",(0,t.jsxs)(i.p,{children:["The list of integration tests is defined in ",(0,t.jsx)(i.code,{children:"miralis.toml"}),".\nFor more control over the tests to run, the ",(0,t.jsx)(i.code,{children:"runner"})," allows filtering by test name.\nFor instance, ",(0,t.jsx)(i.code,{children:"runner test linux"})," will run all tests involving the Linux kernel."]}),"\n",(0,t.jsxs)(i.p,{children:["We provide support for debugging with GDB.\nTo start a GDB session, first run Miralis with ",(0,t.jsx)(i.code,{children:"just debug"})," and then run ",(0,t.jsx)(i.code,{children:"just gdb"})," in another terminal.\nSimilar to ",(0,t.jsx)(i.code,{children:"just run"}),", ",(0,t.jsx)(i.code,{children:"just debug"})," takes an optional firmware argument which can be used to debug a particular image.\nDebugging with GDB requires a RISC-V capable GDB executable in your path.\nIf ",(0,t.jsx)(i.code,{children:"just gdb"})," can't locate such a binary it will provide a list of supported GDB binaries, installing any one of them will resolve the issue."]}),"\n",(0,t.jsxs)(i.p,{children:["The log level can be adjusted using a ",(0,t.jsx)(i.code,{children:"config.toml"})," file. See ",(0,t.jsx)(i.code,{children:"./config/example.config.toml"})," for reference."]}),"\n",(0,t.jsx)(i.h2,{id:"build-configuration",children:"Build Configuration"}),"\n",(0,t.jsxs)(i.p,{children:["Miralis uses ",(0,t.jsx)(i.a,{href:"https://toml.io/",children:"toml"})," for configuration.\nPre-defined build configurations can be found in the ",(0,t.jsx)(i.code,{children:"./config"})," directory.\nIn particular, the ",(0,t.jsx)(i.code,{children:"./config/example.config.toml"})," list the valid configuration fields with explanatory comments."]}),"\n",(0,t.jsxs)(i.p,{children:["By default, the ",(0,t.jsx)(i.code,{children:"runner"})," looks for a configuration named ",(0,t.jsx)(i.code,{children:"config.toml"})," at the root of this repository (this file is ignored by the ",(0,t.jsx)(i.code,{children:".gitignore"}),", so that each developer can keep their own).\nIf none is found, the ",(0,t.jsx)(i.code,{children:"runner"})," resorts to default values.\nUsing a custom ",(0,t.jsx)(i.code,{children:"config.toml"})," file is recommended for developing and debugging.\nIt exposes utilities such as configuring the log level (globally or on a per-module basis) and limiting the maximum number of firmware traps to prevent infinite loops."]}),"\n",(0,t.jsxs)(i.p,{children:["Configurations are especially important when building for a particular platform.\nThe ",(0,t.jsx)(i.code,{children:"just build"})," command takes a configuration as argument.\nThis is how Miralis can be built to target specific platforms (such as the ",(0,t.jsx)(i.code,{children:"visionfive2"})," or ",(0,t.jsx)(i.code,{children:"qemu_virt"}),")."]}),"\n",(0,t.jsx)(i.h2,{id:"test-artifacts",children:"Test Artifacts"}),"\n",(0,t.jsxs)(i.p,{children:["In addition to writing our own test firmware, we test Miralis against third-party projects.\nBecause it would be inconvenient for developers (and expensive on the CI) to build all third-party projects from source, our runner can download pre-compiled binaries that can be used for testing.\nAvailable artifacts are described in an artifact manifest located at ",(0,t.jsx)(i.code,{children:"misc/artifacts.toml"}),".\nThe manifest is a ",(0,t.jsx)(i.a,{href:"https://toml.io/",children:"toml"})," file that lists artifacts in the ",(0,t.jsx)(i.code,{children:"[bin]"})," section with their corresponding download URL."]}),"\n",(0,t.jsxs)(i.p,{children:["We externalize the build of artifacts to other repositories, so that we don't need to build them for each commit on the CI.\nFor instance, our test version of OpenSBI is built ",(0,t.jsx)(i.a,{href:"https://github.com/CharlyCst/miralis-artifact-opensbi",children:"here"}),".\nThese repositories then expose artifacts as binaries through releases, whose download link can be added to the artifact manifest."]}),"\n",(0,t.jsxs)(i.p,{children:["When using ",(0,t.jsx)(i.code,{children:"just run opensbi"}),", the runner will check if there exits a test firmware in a crate named ",(0,t.jsx)(i.code,{children:"opensbi"}),", and because that is not the case, it will look-up the artifact manifest.\nThere is an artifact named ",(0,t.jsx)(i.code,{children:"opensbi"}),", so the runner will check if it is already downloaded, and download it if that is not the case (or if the artifact manifest has been updated since then)."]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>a});var t=n(6540);const r={},o=t.createContext(r);function s(e){const i=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:i},e.children)}}}]);