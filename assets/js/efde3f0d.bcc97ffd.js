"use strict";(self.webpackChunkwebsite_miralis=self.webpackChunkwebsite_miralis||[]).push([[5296],{7319:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var r=n(4848),s=n(8453);const t={title:"HiFive Premier P550",sidebar_position:2},o="HiFive Premier P550",a={id:"platforms/premierp550",title:"HiFive Premier P550",description:"The HiFive Premier P550 is a quad-core board from SifFive featuring the ESWIN EIC7700X SoC.",source:"@site/docs/platforms/premierp550.md",sourceDirName:"platforms",slug:"/platforms/premierp550",permalink:"/docs/platforms/premierp550",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"HiFive Premier P550",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Vision Five 2",permalink:"/docs/platforms/visionfive2"},next:{title:"Test artifacts",permalink:"/docs/artifacts"}},d={},l=[{value:"Building a Miralis image",id:"building-a-miralis-image",level:2},{value:"Firmware Images",id:"firmware-images",level:3},{value:"Building miralis",id:"building-miralis",level:3},{value:"Combining the images",id:"combining-the-images",level:3},{value:"Flashing the Board",id:"flashing-the-board",level:2}];function h(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"hifive-premier-p550",children:"HiFive Premier P550"})}),"\n",(0,r.jsxs)(i.p,{children:["The HiFive Premier P550 is a quad-core board from SifFive featuring the ESWIN EIC7700X SoC.\nThe documentation from Sifive is centralized on ",(0,r.jsx)(i.a,{href:"https://www.sifive.com/boards/hifive-premier-p550",children:"their website"}),".\nThe ",(0,r.jsx)(i.a,{href:"https://sifive.cdn.prismic.io/sifive/Z1h2p5bqstJ98RbK_HF106_user_guide_V1p2_en.pdf",children:"user guide"})," provide a high level overview of the board, while the ",(0,r.jsx)(i.a,{href:"https://www.sifive.com/document-file/hifive-premier-p550-software-reference-manual",children:"software reference manual"})," provides instruction for building the P550 software from source, including firmware images."]}),"\n",(0,r.jsx)(i.p,{children:"Before trying to load a Miralis image on the board, double check that the board is properly booting with the vendor-provided firmware and has a functionning Linux image installed."}),"\n",(0,r.jsx)(i.h2,{id:"building-a-miralis-image",children:"Building a Miralis image"}),"\n",(0,r.jsxs)(i.p,{children:["In the following we details the procedure for building a Miralis image.\nThe instructions assume you run all commands from the ",(0,r.jsx)(i.code,{children:"artifact"})," directory of the miralis repository."]}),"\n",(0,r.jsx)(i.h3,{id:"firmware-images",children:"Firmware Images"}),"\n",(0,r.jsx)(i.p,{children:"Creating an image for the Premier P550 requires 3 firmware images:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.code,{children:"second_boot_fw"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.code,{children:"ddr_fw"})}),"\n",(0,r.jsxs)(i.li,{children:["and ",(0,r.jsx)(i.code,{children:"fw_payload"})]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["SiFive provides images for the first two firmware in ",(0,r.jsx)(i.a,{href:"https://github.com/sifiveinc/hifive-premier-p550-tools",children:"the p550 tools reposity"}),".\nHowever, SiFive does not provide a ",(0,r.jsx)(i.code,{children:"fw_payload"})," image, which is the firmware containing OpenSBI and U-boot proper.\nFor convenience, we provide a pre-build ",(0,r.jsx)(i.code,{children:"fw_payload"})," image for the Premier P550 in ",(0,r.jsx)(i.a,{href:"https://github.com/CharlyCst/premierp550-opensbi",children:"this repository"}),", along with the ",(0,r.jsx)(i.a,{href:"https://github.com/CharlyCst/premierp550-opensbi/blob/main/Makefile",children:"procedure to build the image"})," if you prefer to built it yourself."]}),"\n",(0,r.jsx)(i.p,{children:"To download the three images, run:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"curl -L -o p550_fw_payload.bin https://github.com/CharlyCst/premierp550-opensbi/releases/download/v0.1.2/fw_payload.bin\ncurl -L -o p550_ddr_fw.bin https://github.com/sifiveinc/hifive-premier-p550-tools/raw/a53157562a6df2cee64aff8b49be13c42d900192/ddr-fw/ddr_fw.bin\ncurl -L -o p550_second_boot_fw.bin https://github.com/sifiveinc/hifive-premier-p550-tools/raw/a53157562a6df2cee64aff8b49be13c42d900192/second_boot_fw/second_boot_fw.bin\n"})}),"\n",(0,r.jsx)(i.h3,{id:"building-miralis",children:"Building miralis"}),"\n",(0,r.jsx)(i.p,{children:"Miralis comes with a configuration for the Premier P550.\nSimply run:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"just build config/premierp550.toml\n"})}),"\n",(0,r.jsx)(i.h3,{id:"combining-the-images",children:"Combining the images"}),"\n",(0,r.jsx)(i.p,{children:"The next step is to combine all the firmware images into a single image that can be flashed on the board."}),"\n",(0,r.jsxs)(i.p,{children:["First, we need to insert Miralis in memory.\nOn the Premier P550 we put Miralis in between OpenSBI and U-boot, at ",(0,r.jsx)(i.code,{children:"0x80008000"}),".\nBoth OpenSBI and U-boot are combined in a single Binary, with zeroes in between.\nTo insert Miralis, we simply fill the zeroes in the middle:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"# Copy the OpenSBI + U-boot image\ncp p550_fw_payload.bin p550_combined_fw.bin\n\n# Then fill the zeroes in the middle\ndd if=../target/riscv-unknown-miralis/release/miralis.img of=p550_combined_fw.bin bs=4096 seek=128 conv=notrunc\n"})}),"\n",(0,r.jsxs)(i.p,{children:["This creates a new ",(0,r.jsx)(i.code,{children:"p550_combined_fw.bin"})," image with Miralis, OpenSBI, and U-boot.\nTo combine that image with the other firmware (",(0,r.jsx)(i.code,{children:"p550_second_boot_fw.bin"})," and ",(0,r.jsx)(i.code,{children:"p550_ddr_fw.bin"}),") the Premier P550 relies on a tool from Eswin called ",(0,r.jsx)(i.code,{children:"nsign"}),", which needs to be built from source."]}),"\n",(0,r.jsxs)(i.p,{children:["To build ",(0,r.jsx)(i.code,{children:"nsign"}),", run:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"git clone https://github.com/eswincomputing/Esbd-77serial-nsign\ncd Esbd-77serial-nsign\n./build.sh\ncp nsign ..\ncd ..\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Then, ",(0,r.jsx)(i.code,{children:"nsign"})," takes a configuration as input with the layout of the firmware images.\nCopy the following configuration as ",(0,r.jsx)(i.code,{children:"p550.cfg"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",metastring:'title="p550.cfg"',children:"cmd=chief_sign\nout=p550_miralis.bin\n{\n  in=p550_second_boot_fw.bin\n  boot_flags=SCPU\n  payload_type=FIRMWARE\n  sign_algorithm=plaintext\n  keyid=00\n  version=00000001\n  link_addr=00000000\n  load_addr=59000000\n  entry_addr=59000000\n  payload_flags=plaintext\n  digest_mthd=SHA\n  encrypted_mthd=plaintext\n  devid=0000000000000000\n  vid=00\n  lang=656e67\n  mid=0000000000000000\n  params=00000000000000000000000000000000\n  dl_load_addr=00000000\n  dl_init_ofs=00000000\n  dl_destory_ofs=00000000\n  dl_ioctl_ofs=00000000\n  dl_load_flags=00000000\n  dl_irq_num=00000000\n  dl_irq_ofs=00000000\n}\n{\n  in=p550_ddr_fw.bin\n  boot_flags=SCPU\n  payload_type=DDR\n  sign_algorithm=plaintext\n  keyid=00\n  version=00000001\n  link_addr=00000000\n  load_addr=59000000\n  entry_addr=59000000\n  payload_flags=plaintext\n  digest_mthd=SHA\n  encrypted_mthd=plaintext\n  devid=0000000000000000\n  vid=00\n  lang=656e67\n  mid=0000000000000000\n  params=00000000000000000000000000000000\n  dl_load_addr=00000000\n  dl_init_ofs=00000000\n  dl_destory_ofs=00000000\n  dl_ioctl_ofs=00000000\n  dl_load_flags=00000000\n  dl_irq_num=00000000\n  dl_irq_ofs=00000000\n}\n{\n  in=p550_combined_fw.bin\n  boot_flags=MCPU\n  payload_type=BOOTLOADER\n  sign_algorithm=plaintext\n  keyid=00\n  version=00000001\n  link_addr=00000000\n  load_addr=80000000\n  entry_addr=80080000\n  payload_flags=plaintext\n  digest_mthd=SHA\n  encrypted_mthd=plaintext\n  devid=0000000000000000\n  vid=00\n  lang=656e67\n  mid=0000000000000000\n  params=00000000000000000000000000000000\n  dl_load_addr=00000000\n  dl_init_ofs=00000000\n  dl_destory_ofs=00000000\n  dl_ioctl_ofs=00000000\n  dl_load_flags=00000000\n  dl_irq_num=00000000\n  dl_irq_ofs=00000000\n}\n"})}),"\n",(0,r.jsx)(i.p,{children:"The only two modifications compared to the official configuration are the names of the binaries, and the entry point to transfer control to Miralis rather than to OpenSBI."}),"\n",(0,r.jsx)(i.p,{children:"Then, simply run:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"./nsign p550.cfg\n"})}),"\n",(0,r.jsx)(i.p,{children:"To build the final image."}),"\n",(0,r.jsx)(i.h2,{id:"flashing-the-board",children:"Flashing the Board"}),"\n",(0,r.jsxs)(i.p,{children:["Before starting, ensure the boot can be booted with the vendor images.\nRefer to the ",(0,r.jsx)(i.a,{href:"https://sifive.cdn.prismic.io/sifive/Z1h2p5bqstJ98RbK_HF106_user_guide_V1p2_en.pdf",children:"user guide"})," and the ",(0,r.jsx)(i.a,{href:"https://www.sifive.com/document-file/hifive-premier-p550-software-reference-manual",children:"software reference manual"})," if you encounter any issue."]}),"\n",(0,r.jsxs)(i.p,{children:["First, set the boot pins to ",(0,r.jsx)(i.code,{children:"0011"}),", as in the image below:"]}),"\n",(0,r.jsx)("div",{style:{textAlign:"center"},children:(0,r.jsx)("img",{src:"/img/docs/premierp550_switches.png",height:"150"})}),"\n",(0,r.jsx)(i.p,{children:"This corresponds to the USB boot mode.\nThen connect the USB cables as depicted below:"}),"\n",(0,r.jsx)("div",{style:{textAlign:"center"},children:(0,r.jsx)("img",{src:"/img/docs/premierp550_usb.png",height:"150"})}),"\n",(0,r.jsx)(i.p,{children:"Connect both cables to a host Linux machine (we could not flash the image from macOS).\nPower the board on, two devices should show up:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"ttyUSB3"}),": the serial port of the microcontroler."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"ttyUSB2"}),": the serial port of the main CPU."]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["In addition, the host machine should detect a new drive: this is where we will upload the image.\nTo flash the image, copy ",(0,r.jsx)(i.code,{children:"p550_mliralis.bin"})," created with ",(0,r.jsx)(i.code,{children:"nsign"})," earlier in the ",(0,r.jsx)(i.code,{children:"ESWIN-2030"})," drive (exact path may vary):"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:" cp p550_miralis.bin /run/media/username/ESWIN-2030/\n"})}),"\n",(0,r.jsxs)(i.p,{children:["You should see the boot sequence starting on ",(0,r.jsx)(i.code,{children:"ttyUSB2"}),", with the full boot taking a few minutes.\nMiralis is now running on the P550, virtualizing OpenSBI."]}),"\n",(0,r.jsxs)(i.p,{children:["To reset the board programatically, run ",(0,r.jsx)(i.code,{children:"reboot cold"})," on ",(0,r.jsx)(i.code,{children:"ttyUSB3"}),", then copy a new image to the board."]})]})}function c(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var r=n(6540);const s={},t=r.createContext(s);function o(e){const i=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:i},e.children)}}}]);